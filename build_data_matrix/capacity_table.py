"""
build_data_matrix.capacity_table


capacity table definition

for BYTE, NUMERIC, ALPHA_NUMERIC, KANJI modes

L = Lowest error correction, maximum data
M = Balanced error correction and capacity
Q = Higher error correction for damaged codes
H = Maximum recovery, lowest capacity

"""
from build_data_matrix.encoding import NUMERIC_MODE, ALPHANUMERIC_MODE, BYTE_MODE, KANJI_MODE


BYTE_CAPACITY_TABLE: dict[int, dict[str, int]] = {
    1:  {"L": 17,   "M": 14,   "Q": 11,   "H": 7},
    2:  {"L": 32,   "M": 26,   "Q": 20,   "H": 14},
    3:  {"L": 53,   "M": 42,   "Q": 32,   "H": 24},
    4:  {"L": 78,   "M": 62,   "Q": 46,   "H": 34},
    5:  {"L": 106,  "M": 84,   "Q": 60,   "H": 44},
    6:  {"L": 134,  "M": 106,  "Q": 74,   "H": 58},
    7:  {"L": 154,  "M": 122,  "Q": 86,   "H": 64},
    8:  {"L": 192,  "M": 152,  "Q": 108,  "H": 84},
    9:  {"L": 230,  "M": 180,  "Q": 130,  "H": 98},
    10: {"L": 271,  "M": 213,  "Q": 151,  "H": 119},
    11: {"L": 321,  "M": 251,  "Q": 177,  "H": 137},
    12: {"L": 367,  "M": 287,  "Q": 203,  "H": 155},
    13: {"L": 425,  "M": 331,  "Q": 241,  "H": 177},
    14: {"L": 458,  "M": 362,  "Q": 258,  "H": 194},
    15: {"L": 520,  "M": 412,  "Q": 292,  "H": 220},
    16: {"L": 586,  "M": 450,  "Q": 322,  "H": 250},
    17: {"L": 644,  "M": 504,  "Q": 364,  "H": 280},
    18: {"L": 718,  "M": 560,  "Q": 394,  "H": 310},
    19: {"L": 792,  "M": 624,  "Q": 442,  "H": 338},
    20: {"L": 858,  "M": 666,  "Q": 482,  "H": 382},
    21: {"L": 929,  "M": 711,  "Q": 509,  "H": 403},
    22: {"L": 1003, "M": 779,  "Q": 565,  "H": 439},
    23: {"L": 1091, "M": 857,  "Q": 611,  "H": 461},
    24: {"L": 1171, "M": 911,  "Q": 661,  "H": 511},
    25: {"L": 1273, "M": 997,  "Q": 715,  "H": 535},
    26: {"L": 1367, "M": 1059, "Q": 751,  "H": 593},
    27: {"L": 1465, "M": 1125, "Q": 805,  "H": 625},
    28: {"L": 1528, "M": 1190, "Q": 868,  "H": 658},
    29: {"L": 1628, "M": 1264, "Q": 908,  "H": 698},
    30: {"L": 1732, "M": 1370, "Q": 982,  "H": 742},
    31: {"L": 1840, "M": 1452, "Q": 1030, "H": 790},
    32: {"L": 1952, "M": 1538, "Q": 1112, "H": 842},
    33: {"L": 2068, "M": 1628, "Q": 1168, "H": 898},
    34: {"L": 2188, "M": 1722, "Q": 1228, "H": 958},
    35: {"L": 2303, "M": 1809, "Q": 1283, "H": 983},
    36: {"L": 2431, "M": 1911, "Q": 1351, "H": 1051},
    37: {"L": 2563, "M": 1989, "Q": 1423, "H": 1093},
    38: {"L": 2699, "M": 2099, "Q": 1499, "H": 1139},
    39: {"L": 2809, "M": 2213, "Q": 1579, "H": 1219},
    40: {"L": 2953, "M": 2331, "Q": 1663, "H": 1273},
}


NUMERIC_CAPACITY_TABLE: dict[int, dict[str, int]] = {
    1:  {"L": 41,   "M": 34,   "Q": 27,   "H": 17},
    2:  {"L": 77,   "M": 63,   "Q": 48,   "H": 34},
    3:  {"L": 127,  "M": 101,  "Q": 77,   "H": 58},
    4:  {"L": 187,  "M": 149,  "Q": 111,  "H": 82},
    5:  {"L": 255,  "M": 202,  "Q": 144,  "H": 106},
    6:  {"L": 322,  "M": 255,  "Q": 178,  "H": 139},
    7:  {"L": 370,  "M": 293,  "Q": 207,  "H": 154},
    8:  {"L": 461,  "M": 365,  "Q": 259,  "H": 202},
    9:  {"L": 552,  "M": 432,  "Q": 312,  "H": 235},
    10: {"L": 652,  "M": 513,  "Q": 364,  "H": 288},
    11: {"L": 772,  "M": 604,  "Q": 427,  "H": 331},
    12: {"L": 883,  "M": 691,  "Q": 489,  "H": 374},
    13: {"L": 1022, "M": 796,  "Q": 580,  "H": 427},
    14: {"L": 1101, "M": 871,  "Q": 621,  "H": 468},
    15: {"L": 1250, "M": 991,  "Q": 703,  "H": 530},
    16: {"L": 1408, "M": 1082, "Q": 775,  "H": 602},
    17: {"L": 1548, "M": 1212, "Q": 876,  "H": 674},
    18: {"L": 1725, "M": 1346, "Q": 948,  "H": 746},
    19: {"L": 1903, "M": 1500, "Q": 1063, "H": 813},
    20: {"L": 2061, "M": 1600, "Q": 1159, "H": 919},
    21: {"L": 2232, "M": 1708, "Q": 1224, "H": 969},
    22: {"L": 2409, "M": 1872, "Q": 1358, "H": 1056},
    23: {"L": 2620, "M": 2059, "Q": 1468, "H": 1108},
    24: {"L": 2812, "M": 2188, "Q": 1588, "H": 1228},
    25: {"L": 3057, "M": 2395, "Q": 1718, "H": 1286},
    26: {"L": 3283, "M": 2544, "Q": 1804, "H": 1425},
    27: {"L": 3517, "M": 2701, "Q": 1933, "H": 1501},
    28: {"L": 3669, "M": 2857, "Q": 2085, "H": 1581},
    29: {"L": 3909, "M": 3035, "Q": 2181, "H": 1677},
    30: {"L": 4158, "M": 3289, "Q": 2358, "H": 1782},
    31: {"L": 4417, "M": 3486, "Q": 2473, "H": 1897},
    32: {"L": 4686, "M": 3693, "Q": 2670, "H": 2022},
    33: {"L": 4965, "M": 3909, "Q": 2805, "H": 2157},
    34: {"L": 5253, "M": 4134, "Q": 2949, "H": 2301},
    35: {"L": 5529, "M": 4343, "Q": 3081, "H": 2361},
    36: {"L": 5836, "M": 4588, "Q": 3244, "H": 2524},
    37: {"L": 6153, "M": 4775, "Q": 3417, "H": 2625},
    38: {"L": 6479, "M": 5039, "Q": 3599, "H": 2735},
    39: {"L": 6743, "M": 5313, "Q": 3791, "H": 2927},
    40: {"L": 7089, "M": 5596, "Q": 3993, "H": 3057},
}

ALPHANUMERIC_CAPACITY_TABLE: dict[int, dict[str, int]] = {
    1:  {"L": 25,   "M": 20,   "Q": 16,   "H": 10},
    2:  {"L": 47,   "M": 38,   "Q": 29,   "H": 20},
    3:  {"L": 77,   "M": 61,   "Q": 47,   "H": 35},
    4:  {"L": 114,  "M": 90,   "Q": 67,   "H": 50},
    5:  {"L": 154,  "M": 122,  "Q": 87,   "H": 64},
    6:  {"L": 195,  "M": 154,  "Q": 108,  "H": 84},
    7:  {"L": 224,  "M": 178,  "Q": 125,  "H": 93},
    8:  {"L": 279,  "M": 221,  "Q": 157,  "H": 122},
    9:  {"L": 335,  "M": 262,  "Q": 189,  "H": 143},
    10: {"L": 395,  "M": 311,  "Q": 221,  "H": 174},
    11: {"L": 468,  "M": 366,  "Q": 259,  "H": 200},
    12: {"L": 535,  "M": 419,  "Q": 296,  "H": 227},
    13: {"L": 619,  "M": 483,  "Q": 352,  "H": 259},
    14: {"L": 667,  "M": 528,  "Q": 376,  "H": 283},
    15: {"L": 758,  "M": 600,  "Q": 426,  "H": 321},
    16: {"L": 854,  "M": 656,  "Q": 470,  "H": 365},
    17: {"L": 938,  "M": 734,  "Q": 531,  "H": 408},
    18: {"L": 1046, "M": 816,  "Q": 574,  "H": 452},
    19: {"L": 1153, "M": 909,  "Q": 644,  "H": 493},
    20: {"L": 1249, "M": 970,  "Q": 702,  "H": 557},
    21: {"L": 1352, "M": 1035, "Q": 742,  "H": 587},
    22: {"L": 1460, "M": 1134, "Q": 823,  "H": 640},
    23: {"L": 1588, "M": 1248, "Q": 890,  "H": 672},
    24: {"L": 1704, "M": 1326, "Q": 963,  "H": 744},
    25: {"L": 1853, "M": 1451, "Q": 1041, "H": 779},
    26: {"L": 1990, "M": 1542, "Q": 1094, "H": 864},
    27: {"L": 2132, "M": 1637, "Q": 1172, "H": 910},
    28: {"L": 2223, "M": 1732, "Q": 1263, "H": 958},
    29: {"L": 2369, "M": 1839, "Q": 1322, "H": 1016},
    30: {"L": 2520, "M": 1994, "Q": 1429, "H": 1080},
    31: {"L": 2677, "M": 2113, "Q": 1499, "H": 1150},
    32: {"L": 2840, "M": 2238, "Q": 1618, "H": 1226},
    33: {"L": 3009, "M": 2369, "Q": 1700, "H": 1307},
    34: {"L": 3183, "M": 2506, "Q": 1787, "H": 1394},
    35: {"L": 3351, "M": 2632, "Q": 1867, "H": 1431},
    36: {"L": 3537, "M": 2780, "Q": 1966, "H": 1530},
    37: {"L": 3729, "M": 2894, "Q": 2071, "H": 1591},
    38: {"L": 3927, "M": 3054, "Q": 2181, "H": 1658},
    39: {"L": 4087, "M": 3220, "Q": 2298, "H": 1774},
    40: {"L": 4296, "M": 3391, "Q": 2420, "H": 1852},
}


KANJI_CAPACITY_TABLE: dict[int, dict[str, int]] = {
    1:  {"L": 10,  "M": 8,   "Q": 7,   "H": 4},
    2:  {"L": 20,  "M": 16,  "Q": 12,  "H": 8},
    3:  {"L": 32,  "M": 26,  "Q": 20,  "H": 15},
    4:  {"L": 48,  "M": 38,  "Q": 28,  "H": 21},
    5:  {"L": 65,  "M": 52,  "Q": 37,  "H": 27},
    6:  {"L": 82,  "M": 65,  "Q": 45,  "H": 36},
    7:  {"L": 95,  "M": 75,  "Q": 53,  "H": 39},
    8:  {"L": 118, "M": 93,  "Q": 66,  "H": 52},
    9:  {"L": 141, "M": 111, "Q": 80,  "H": 60},
    10: {"L": 167, "M": 131, "Q": 93,  "H": 74},
    11: {"L": 198, "M": 155, "Q": 109, "H": 85},
    12: {"L": 226, "M": 177, "Q": 125, "H": 96},
    13: {"L": 262, "M": 204, "Q": 149, "H": 109},
    14: {"L": 282, "M": 223, "Q": 159, "H": 120},
    15: {"L": 320, "M": 254, "Q": 180, "H": 136},
    16: {"L": 361, "M": 277, "Q": 198, "H": 154},
    17: {"L": 397, "M": 310, "Q": 224, "H": 173},
    18: {"L": 442, "M": 345, "Q": 243, "H": 191},
    19: {"L": 488, "M": 384, "Q": 272, "H": 208},
    20: {"L": 528, "M": 410, "Q": 297, "H": 235},
    21: {"L": 572, "M": 438, "Q": 314, "H": 248},
    22: {"L": 618, "M": 480, "Q": 348, "H": 270},
    23: {"L": 672, "M": 528, "Q": 376, "H": 284},
    24: {"L": 721, "M": 561, "Q": 407, "H": 315},
    25: {"L": 784, "M": 614, "Q": 440, "H": 330},
    26: {"L": 843, "M": 652, "Q": 462, "H": 365},
    27: {"L": 904, "M": 692, "Q": 496, "H": 385},
    28: {"L": 947, "M": 732, "Q": 534, "H": 405},
    29: {"L": 1005,"M": 778, "Q": 559, "H": 430},
    30: {"L": 1063,"M": 843, "Q": 604, "H": 457},
    31: {"L": 1125,"M": 890, "Q": 634, "H": 486},
    32: {"L": 1190,"M": 947, "Q": 684, "H": 518},
    33: {"L": 1264,"M": 1003,"Q": 719, "H": 553},
    34: {"L": 1332,"M": 1061,"Q": 756, "H": 590},
    35: {"L": 1405,"M": 1113,"Q": 790, "H": 605},
    36: {"L": 1485,"M": 1176,"Q": 832, "H": 647},
    37: {"L": 1571,"M": 1224,"Q": 876, "H": 673},
    38: {"L": 1663,"M": 1292,"Q": 923, "H": 701},
    39: {"L": 1729,"M": 1362,"Q": 972, "H": 750},
    40: {"L": 1817,"M": 1435,"Q": 1024,"H": 784},
}


CAPACITY_TABLE: dict[int, dict] = {
    NUMERIC_MODE: NUMERIC_CAPACITY_TABLE,
    ALPHANUMERIC_MODE: ALPHANUMERIC_CAPACITY_TABLE,
    BYTE_MODE: BYTE_CAPACITY_TABLE,
    KANJI_MODE: KANJI_CAPACITY_TABLE
}



def get_version(data: str, ec_level: str, encoding_mode: int) -> int:
    size = len(data)

    for version in sorted(CAPACITY_TABLE[encoding_mode]):
        if size <= CAPACITY_TABLE[encoding_mode][version][ec_level]:
            return version
    
    raise ValueError("Data too large for QR code")
